<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Primary Meta Tags -->
        <title>Lars Erik Schonander</title>
        <meta name="title" content="Lars Erik Schonander">
        <meta name="description" content="Personal writing, links, and other miscellanea by Lars Erik Schonander. ">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://www.larserikschonander.com/">
        <meta property="og:title" content="Lars Erik Schonander">
        <meta property="og:description" content="Personal writing, links, and other miscellanea by Lars Erik Schonander. ">
        <meta property="og:image" content>

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://www.larserikschonander.com/">
        <meta property="twitter:title" content="Lars Erik Schonander">
        <meta property="twitter:description" content="Personal writing, links, and other miscellanea by Lars Erik Schonander. ">
        <meta property="twitter:image" content>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="shortcut icon" href="../images/icon_HSn_icon.ico" type="image/x-icon" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121467707-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-121467707-1');
    </script>
    </head>
    <body>  
        <h1 id="name">Lars E. Schonander</h1>
        <header>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../graphics.html">Graphics</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            
        </header>

        <main role="main">
            <h1>An Introduction to Prophet</h1>
            <article>
    <section class="header">
        Posted on July  1, 2018
        
    </section>
    <section>
        <p><a href="https://facebook.github.io/prophet/"><strong>Prophet</strong></a>, released by Facebook Open Source, is an interesting library for Python and R. Straddling the line between statistical modeling and machine learning, it is an open source tool I have not seen talked about much, even though it is rather interesting. Prophet is a tool for forecasting time series data, such as weather or page views.</p>
<p>To get started, here is a little tutorial of Prophet.</p>
<h3 id="note">Note:</h3>
<p>As seen on the <a href="https://github.com/facebook/prophet/issues/2">issues</a> page on GitHub, Prophet has some problems working on Windows computers. While a majority of the functionality will work, some parts, such as graphing the predictions, will not work, partly because of Prophet and because of the main dependency, <a href="https://pystan.readthedocs.io/en/latest/">PyStan</a>, which also seems to have problems on Windows. As usual to install PyStan to get started:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1">pip install pystan</a></code></pre></div>
<p>To begin, follow the previous installation along with doing the below to install prophet on your machine.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1">pip install fbprophet</a></code></pre></div>
<p>For this example, we will be using a dataset from <a href="https://tools.wmflabs.org/pageviews/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;range=latest-20&amp;pages=">PageViews</a>, a Wikimedia service that allows one to see the daily page views of any page of Wikipedia, along with other related services such as redirect views and compare across languages, a useful service to track the popularity of subjects.</p>
<p>For this tutorial, we will be looking at the pageviews of newly famous politician <a href="https://en.wikipedia.org/wiki/Alexandria_Ocasio-Cortez">Alexandria Ocasio-Cortez</a>, mainly because it is interesting how much reporting around her has exploded, and this can be seen with her pageview results.</p>
<p>To start, here is the following</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">from</span> fbprophet <span class="im">import</span> Prophet</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">plt.style.use(<span class="st">'Solarize_Light2'</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">dataframe <span class="op">=</span> pd.read_csv(<span class="st">'Alexandria.csv'</span>)</a></code></pre></div>
<p>One does not need matplotlib for Prophet, but it will prove useful for doing an initial look at the dataset. We need <a href="https://pandas.pydata.org/">Pandas</a> to shape the CSV file into a data frame useable by Prophet. The data itself requires <em>two</em> forms of data. First the time series data in the form of month/day/year and a Y variable, such as pageviews in this case, which is the data we are forecasting.</p>
<p>Before working with Prophet, here is some simple tools from Pandas to have a look at the dataset</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="bu">print</span>(df.describe())</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">dataframe.hist()</a>
<a class="sourceLine" id="cb4-4" title="4">plt.ylabel(<span class="st">&quot;Occurrence&quot;</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</a>
<a class="sourceLine" id="cb4-5" title="5">plt.title(<span class="st">&quot;Histogram of Daily Page Views&quot;</span>, fontsize <span class="op">=</span> <span class="dv">20</span>)</a></code></pre></div>
<p>Describe result here</p>
<pre><code>                   y
count      21.000000
mean     8683.809524
std     39661.332898
min         2.000000
25%        12.000000
50%        24.000000
75%        32.000000
max    181780.000000</code></pre>
<p>As seen, the page is quite new, with their being a very large difference between the min, max, mean, and standard deviation (std) That max is from the last day of the set, being 6/27/2018, the day after she won her primary in 14th congressional district of New York against incumbent Democratic Representative Joseph Crowley.</p>
<p>Now here is the basic code to work with Prophet.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1">model <span class="op">=</span> Prophet()</a>
<a class="sourceLine" id="cb6-2" title="2">model.fit(dataframe)</a>
<a class="sourceLine" id="cb6-3" title="3">future <span class="op">=</span> m.make_future_dataframe(periods<span class="op">=</span><span class="dv">365</span>)</a></code></pre></div>
<p>First with Prophet() to initiate the Prophet object to analyze the dataframe, then we with the Prophet object fit our dataset into it, and in that last line of code, we make a forecast that is equal to 365 days, with periods=365 meaning we specify to look 365 days/1 year later.</p>
<p>And now for the last portion, where we can look at the results of the analysis.</p>
<h3 id="note-1">Note:</h3>
<p>Sometimes when running the code, the phrase <em>Hessian Matrix</em> will show up. The Hessian Matrix is a matrix of 2nd partial derivatives.</p>
<p>For example, let us say we have x<sup>2</sup> + y<sup>2</sup> + z<sup>2</sup>. The first derivative would be 2x + 2y + 2z and the 2nd derivative would be 2 + 2 + 2.</p>
<p>Partial derivatives are only when you take the derivative of one part of the equation however, so the partial derivative of the first unknown would be 2x + y<sup>2</sup> + z<sup>2</sup>, with the 2nd partial derivative for x being 2 + 0 + 0. We can plot these results into a matrix then!</p>
<p>With these numbers for example:</p>
<pre><code>[2,0,0 (2nd partial derivative of x)
 0,2,0 (2nd partial derivative of y)
 0,0,2](2nd partial derivative of z)</code></pre>
<p>Now for the results of the analysis.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb8-1" title="1"><span class="bu">print</span>(future.tail())</a>
<a class="sourceLine" id="cb8-2" title="2">forecast <span class="op">=</span> model.predict(future)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="bu">print</span>(forecast[[<span class="st">'ds'</span>, <span class="st">'yhat'</span>, <span class="st">'yhat_lower'</span>, <span class="st">'yhat_upper'</span>]].tail())</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="bu">print</span>(forecast.describe())</a></code></pre></div>
<p>First let us look at the print statement:</p>
<pre><code>            ds           yhat     yhat_lower     yhat_upper
381 2019-06-23  687963.404739  652022.556382  728502.770550
382 2019-06-24  687961.602067  649358.178347  726809.029122
383 2019-06-25  688009.537470  649664.221806  725880.952722
384 2019-06-26  748545.400747  708648.671636  789416.559359
385 2019-06-27  700957.348619  659259.490072  738761.610851</code></pre>
<p><em>Y-hat</em> stands for predicted y value on this case, in this case we are predicting average page views. Here we are printing the tail of our future forecasts, so for example on day 381 we get an average y-hat of <code>687963.404739</code>. The lower and upper y-hate values represent the 25% / 75% range in forecasted values respectively.</p>
<p>Now a look with pandas at a description of the forecast value.</p>
<pre><code>               trend     yhat_lower      ...        multiplicative_terms_upper           yhat
count     386.000000     386.000000      ...                             386.0     386.000000
mean   347070.886224  307883.437338      ...                               0.0  347062.884321
std    206902.507379  208053.515036      ...                               0.0  207938.495639
min     -9902.806374  -54435.244935      ...                               0.0  -13006.850626
25%    168583.245236  129992.390964      ...                               0.0  168733.079942
50%    347070.857915  310056.019017      ...                               0.0  350458.653974
75%    525558.470594  487103.625723      ...                               0.0  525716.758356
max    704046.083273  708648.671636      ...                               0.0  748545.400747</code></pre>
<p>The count in this case includes the initial data points before we initiated profit. The min value is a bit strange, but sans that the numbers look reasonable. <strong>However</strong> one cannot take these values at face value initially, not because they are wrong, but it is good to double check ones claims.</p>
<p>To finish off, let us compare our predictions to the actual <a href="https://tools.wmflabs.org/pageviews/?project=en.wikipedia.org&amp;platform=all-access&amp;agent=user&amp;start=2018-06-09&amp;end=2018-06-29&amp;pages=Alexandria_Ocasio-Cortez">Pageviews</a> results for the past two days.</p>
<pre><code>6/28/2018: 133,285
6/29/2018: 83,014</code></pre>
<p>With the last value, the forecast is rather close! The discrepancy can be explained because her page is so new, and the change values is rather extreme. To test Prophet better, it would be easier to do this on a larger dataset that goes back further in time, for example the page for The United States of America.</p>
<p>Future ways to use Prophet include using it as a tool to look at datasets that have time series data such as stocks or adding an additional variable to look at special changes in time series data or check for seasonality in the model.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly built with 
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            <br>
            Follow me at:
            <a href="https://twitter.com/LarsESchonander">@LarsESchonander</a>
        </footer>
    </body>
</html>
