<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Lars Schonander</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="shortcut icon" href="../images/icon_HSn_icon.ico" type="image/x-icon" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121467707-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-121467707-1');
    </script>
    </head>
    <body>  
        <h1 id="name">Lars E. Schonander</h1>
        <header>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            
        </header>

        <main role="main">
            <h1>Prototyping APIs with Flask</h1>
            <article>
    <section class="header">
        Posted on July 17, 2018
        
    </section>
    <section>
        <p><a href="http://flask.pocoo.org/"><strong>Flask</strong></a> is a nice framework for Python that makes it easy to do various web-development projects in Python. Unlike Django, which is a just as good framework for web-development in Python, Flask is focused on having minimal boiler plate, and for the developer to only install what they need.</p>
<p>One part of flask which is useful to use for full stack web development purposes is for easy creation of GET HTTP APIs.</p>
<p>We will first go over the creation of a basic GET API created in Flask, and as a bonus see part of the client interface that receives the API.</p>
<p>To begin with the server, issue the following command in a folder created for a project.</p>
<pre><code>python -m venv env</code></pre>
<p>This will create a virtual environment to separate the various packages needed to work with Flask.</p>
<p>If you do not have <code>virtualenv</code> installed, do <code>pip install virtualenv</code> to be able to create a virtual environment. Before installing anything, go to env/Scripts/activate to activate the virtual enviroment.</p>
<p>Next to work with Flask, install the following</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1">pip install install Flask<span class="op">==</span><span class="dv">1</span>.<span class="fl">0.2</span> Flask<span class="op">-</span>Cors<span class="op">==</span><span class="dv">3</span>.<span class="fl">0.6</span></a></code></pre></div>
<p>Remember to do the most recent versions, I did a tutorial recently that used an older version of Flask-Cors and it did not work as a result so check the packages your installing.</p>
<p>Next for the sake of time we will do it in one file but in production often the routes, JSON and other information is separated. In this case the routes and JSON are separated, so it is required to import the JSON being used.</p>
<p>Before that, here is a setup app.py file for a basic Flask GET API</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="im">from</span> flask <span class="im">import</span> Flask, jsonify</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="im">from</span> flask_cors <span class="im">import</span> CORS</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="im">import</span> json</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">data <span class="op">=</span> json.loads(<span class="bu">open</span>(<span class="st">&quot;social_conflicts2.json&quot;</span>).read())</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">DEBUG <span class="op">=</span> <span class="va">True</span> <span class="co">#Config</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">app <span class="op">=</span> Flask(<span class="va">__name__</span>) <span class="co">#ready app</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">app.config.from_object(<span class="va">__name__</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">CORS(app) <span class="co">#cors up</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="at">@app.route</span>(<span class="st">'/conflict'</span>, methods<span class="op">=</span>[<span class="st">'GET'</span>])</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw">def</span> conflicts():</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">    <span class="cf">return</span> jsonify({</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">        <span class="st">'status'</span>: <span class="st">'success'</span>,</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">        <span class="st">'conflicts'</span>: data</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">    })</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">    app.run()</a></code></pre></div>
<p>This does the following. The first line imports Flask and a Flask package to read JSON data. The second line then imports flask_cors for <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">cross origin resource sharing</a> to access resources in different domains.</p>
<p>Then, the next relevant line imports the JSON data to be read. The next several lines are configuration for flask, with then CORS being set up for the flask app.</p>
<p>To create a route in flask and actually send the JSON, one needs to specify <code>@app.route</code>. This will create a route for the Flask Server. In this case, the server has a <code>methods=['GET']</code> specify it is a get request. It also has a <code>return jsonify</code>, for sending the JSON data to the server to be called.</p>
<p>After all of this is set up run the following command</p>
<pre><code>python app.py 
OR
flask run</code></pre>
<p>Either command will start the Flask server at <code>http://127.0.0.1:5000</code>. Now navigate to <code>http://127.0.0.1:5000/conflict</code> and you can see the JSON data displayed on the webpage. With this JSON data for example the following results appear</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">{</span><span class="dt">&quot;conflicts&quot;</span><span class="fu">:{</span><span class="dt">&quot;conflicts&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">&quot;characteristics&quot;</span><span class="fu">:</span><span class="st">&quot;Marcha&quot;</span><span class="fu">,</span><span class="dt">&quot;date&quot;</span><span class="fu">:</span><span class="st">&quot;5/13/2018&quot;</span><span class="fu">,</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">1</span><span class="fu">,</span><span class="dt">&quot;lat&quot;</span><span class="fu">:</span><span class="fl">11.85665574</span><span class="fu">,</span><span class="dt">&quot;long&quot;</span><span class="fu">:</span><span class="fl">-86.24060802</span><span class="fu">,</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;Repudio de la Violencia Pol</span><span class="ch">\u00c3\u00ad</span><span class="st">tica y criminalizaci</span><span class="ch">\u00c3\u00b3</span><span class="st">n de la protesta&quot;</span><span class="fu">,</span><span class="dt">&quot;violence_level&quot;</span><span class="fu">:</span><span class="st">&quot;No Violento&quot;</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;characteristics&quot;</span><span class="fu">:</span><span class="st">&quot;Bloqueo de calle/carretera&quot;</span><span class="fu">,</span><span class="dt">&quot;date&quot;</span><span class="fu">:</span><span class="st">&quot;5/13/2018&quot;</span><span class="fu">,</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;lat&quot;</span><span class="fu">:</span><span class="fl">12.49519325</span><span class="fu">,</span><span class="dt">&quot;long&quot;</span><span class="fu">:</span><span class="fl">-85.63962154</span><span class="fu">,</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;Repudio de la Violencia Pol</span><span class="ch">\u00c3\u00ad</span><span class="st">tica y criminalizaci</span><span class="ch">\u00c3\u00b3</span><span class="st">n de la protesta&quot;</span><span class="fu">,</span><span class="dt">&quot;violence_level&quot;</span><span class="fu">:</span><span class="st">&quot;Bajo&quot;</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;characteristics&quot;</span><span class="fu">:</span><span class="st">&quot;Heridos,Muertos,Uso de armas de fuego&quot;</span><span class="fu">,</span><span class="dt">&quot;date&quot;</span><span class="fu">:</span><span class="st">&quot;5/10/2018&quot;</span><span class="fu">,</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">3</span><span class="fu">,</span><span class="dt">&quot;lat&quot;</span><span class="fu">:</span><span class="fl">12.26481516</span><span class="fu">,</span><span class="dt">&quot;long&quot;</span><span class="fu">:</span><span class="fl">-86.56278424</span><span class="fu">,</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;Repudio de la Violencia Pol</span><span class="ch">\u00c3\u00ad</span><span class="st">tica y criminalizaci</span><span class="ch">\u00c3\u00b3</span><span class="st">n de la protesta&quot;</span><span class="fu">,</span><span class="dt">&quot;violence_level&quot;</span><span class="fu">:</span><span class="st">&quot;Alto&quot;</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;characteristics&quot;</span><span class="fu">:</span><span class="st">&quot;Bloqueo de calle/carretera&quot;</span><span class="fu">,</span><span class="dt">&quot;date&quot;</span><span class="fu">:</span><span class="st">&quot;5/9/2018&quot;</span><span class="fu">,</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">4</span><span class="fu">,</span><span class="dt">&quot;lat&quot;</span><span class="fu">:</span><span class="fl">13.48363398</span><span class="fu">,</span><span class="dt">&quot;long&quot;</span><span class="fu">:</span><span class="fl">-86.58223562</span><span class="fu">,</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;Repudio de la Violencia Pol</span><span class="ch">\u00c3\u00ad</span><span class="st">tica y criminalizaci</span><span class="ch">\u00c3\u00b3</span><span class="st">n de la protesta&quot;</span><span class="fu">,</span><span class="dt">&quot;violence_level&quot;</span><span class="fu">:</span><span class="st">&quot;Bajo&quot;</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;characteristics&quot;</span><span class="fu">:</span><span class="st">&quot;Marcha&quot;</span><span class="fu">,</span><span class="dt">&quot;date&quot;</span><span class="fu">:</span><span class="st">&quot;5/8/2018&quot;</span><span class="fu">,</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">5</span><span class="fu">,</span><span class="dt">&quot;lat&quot;</span><span class="fu">:</span><span class="fl">12.23627627</span><span class="fu">,</span><span class="dt">&quot;long&quot;</span><span class="fu">:</span><span class="fl">-86.43018655</span><span class="fu">,</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;Repudio de la Violencia Pol</span><span class="ch">\u00c3\u00ad</span><span class="st">tica y criminalizaci</span><span class="ch">\u00c3\u00b3</span><span class="st">n de la protesta&quot;</span><span class="fu">,</span><span class="dt">&quot;violence_level&quot;</span><span class="fu">:</span><span class="st">&quot;No Violento&quot;</span><span class="fu">}</span><span class="ot">]</span><span class="fu">},</span><span class="dt">&quot;status&quot;</span><span class="fu">:</span><span class="st">&quot;success&quot;</span><span class="fu">}</span></a></code></pre></div>
<p>This data can then be the used in Flask with Flask templates or be feed for UI purposes on a JavaScript frontend.</p>
<h4 id="bonus">Bonus</h4>
<p>As an example of displaying this data, here is a simple React component using the Flask data as a source of information, and then displaying it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">class</span> Feed <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span><span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">        <span class="kw">super</span>(props)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">        <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">            <span class="dt">error</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">            <span class="dt">isLoaded</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">            <span class="dt">conflicts</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">        <span class="op">};</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="at">fetch</span>(<span class="st">&quot;http://127.0.0.1:5000/conflict&quot;</span>)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">        .<span class="at">then</span>(res <span class="op">=&gt;</span> <span class="va">res</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">        .<span class="at">then</span>(</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">            (result) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">                <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">                    <span class="dt">isLoaded</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">                    <span class="dt">conflicts</span><span class="op">:</span> <span class="va">result</span>.<span class="at">conflicts</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20">                <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">            <span class="op">},</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22">            (error) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">                <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">                    <span class="dt">isLoaded</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">                    error</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">                <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27">            <span class="op">}</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">        )</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30">    <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31">        <span class="kw">const</span> <span class="op">{</span>error<span class="op">,</span> isLoaded<span class="op">,</span> conflicts<span class="op">}</span> <span class="op">=</span> <span class="kw">this</span>.<span class="at">state</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">        <span class="cf">if</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33">            <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span> <span class="dt">Error</span><span class="op">:</span> API not <span class="va">loading</span>... &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34">        <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>isLoaded) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35">            <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span><span class="va">Loading</span>... &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36">        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb6-38" data-line-number="38">                <span class="op">&lt;</span>table<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39">                    <span class="op">&lt;</span>tr<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40">                        <span class="op">&lt;</span>th<span class="op">&gt;</span>Organizer&lt;/th<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41">                        <span class="op">&lt;</span>th<span class="op">&gt;</span>Characteristics&lt;/th<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-42" data-line-number="42">                        <span class="op">&lt;</span>th<span class="op">&gt;</span>Violence Level&lt;/th<span class="op">&gt;</span> </a>
<a class="sourceLine" id="cb6-43" data-line-number="43">                        <span class="op">&lt;</span>th<span class="op">&gt;</span>Date&lt;/th<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-44" data-line-number="44">                    &lt;/tr<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45">                    <span class="op">{</span><span class="va">conflicts</span>.<span class="va">conflicts</span>.<span class="at">map</span>(conflict <span class="op">=&gt;</span> ( <span class="ss">/</span></a>
<a class="sourceLine" id="cb6-46" data-line-number="46">                        <span class="op">&lt;</span>tbody<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-47" data-line-number="47">                            <span class="op">&lt;</span>tr key<span class="op">={</span><span class="va">conflict</span>.<span class="at">id</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb6-48" data-line-number="48">                                <span class="op">&lt;</span>td<span class="op">&gt;</span> <span class="op">{</span><span class="va">conflict</span>.<span class="at">name</span><span class="op">}</span> &lt;/td<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-49" data-line-number="49">                                <span class="op">&lt;</span>td<span class="op">&gt;</span> <span class="op">{</span><span class="va">conflict</span>.<span class="at">characteristics</span><span class="op">}</span> <span class="op">&amp;</span>nbsp<span class="op">;</span>&lt;/td<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50">                                <span class="op">&lt;</span>td<span class="op">&gt;</span> <span class="op">{</span><span class="va">conflict</span>.<span class="at">violence_level</span><span class="op">}</span>  <span class="op">&amp;</span>nbsp<span class="op">;</span>&lt;/td<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-51" data-line-number="51">                                <span class="op">&lt;</span>td<span class="op">&gt;</span> <span class="op">{</span><span class="va">conflict</span>.<span class="at">date</span><span class="op">}</span> &lt;/td<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-52" data-line-number="52">                            &lt;/tr<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-53" data-line-number="53">                        &lt;/tbody<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-54" data-line-number="54">                    ))<span class="op">}</span> </a>
<a class="sourceLine" id="cb6-55" data-line-number="55">                &lt;/table<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-56" data-line-number="56">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb6-57" data-line-number="57">        <span class="op">}</span></a>
<a class="sourceLine" id="cb6-58" data-line-number="58">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-59" data-line-number="59"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-60" data-line-number="60"></a>
<a class="sourceLine" id="cb6-61" data-line-number="61"><span class="im">export</span> <span class="im">default</span> Feed</a></code></pre></div>
<p>To summarize what this stateful react component does, with Reacts inbuilt request function, it calls the Flask API, stores the JSON into a array, and then creates a table with the data being various parts of the JSON data. One can do something similar in Vanilla JavaScript and in other JavaScript frameworks, or just create the client with Flask Templates.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly built with 
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
            <br>
            Follow me at:
            <a href="https://twitter.com/LarsESchonander">@LarsESchonander</a>
        </footer>
    </body>
</html>
